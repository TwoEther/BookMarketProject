<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="fragments/header :: header" />
<style>
    .fieldError {
    border-color: #bd2130;
    }
</style>
<body>

<div class="container">
    <div th:replace="fragments/bodyHeader :: bodyHeader" />
    <form role="form" id="loginForm" th:action="@{/member/new}" th:object="${memberForm}"
          method="post">
        <div class="form-group">
            <label th:for="id">아이디</label>
            <input type="hidden" th:name="${_csrf.parameterName}"
                      th:value="${_csrf.token}" />
            <input type="text" th:field="*{userId}" id="userId" class="form-control"
                   placeholder="아이디을 입력하세요"
                   th:class="${#fields.hasErrors('userId')}? 'form-control
fieldError' : 'form-control'">
            <span id="result"></span>
            <p th:if="${#fields.hasErrors('userId')}"
               th:errors="*{userId}">Incorrect date</p>
            <a type="button" class = "btn btn-secondary" id="idck" onclick="idCheck()">중복체크</a>
<!--            <button type="submit"  th:href="@{/member/emailCheck}" class="btn btn-primary">중복체크</button>-->
            <script th:inline="javascript">
                var token = $("meta[name='_csrf']").attr("content");
                var header = $("meta[name='_csrf_header']").attr("content");
                $(function() {
                    $(document).ajaxSend(function(e, xhr, options) {
                        xhr.setRequestHeader(header, token);
                    });
                });
                function idCheck(){
                    $.ajax({
                        url : "/member/idCheck",
                        type : "POST",
                        dataType : "JSON",
                        data : {"userId" : $("#userId").val()},
                        beforeSend: function (xhr) {
                          xhr.setRequestHeader(header, token);
                        },
                        success : function(flag){
                            if(flag == 0){
                                alert("아이디를 입력해주세요");
                            }else if(flag == 1){
                                alert("사용 불가능한 아이디 입니다");
                                $('#result').text('사용 불가능한 아이디입니다.');
                            }
                            else{
                                alert("사용 가능한 아이디 입니다");
                                $('#result').text('사용 가능한 아이디입니다.');
                                $('idck').hide();
                            }
                        },
                        error:function(request,status,error){
                        alert("code = "+ request.status + " message = " + request.responseText + " error = " + error); // 실패 시 처리
                       }
                    });
                }
            </script>
            </div>

            <div class="form-group">
                <label th:for="password">비밀번호</label>
                <input type="hidden" th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />
                <input type="password" th:field="*{password}" class="form-control"
                       placeholder="비밀번호를 입력하세요" id="pw1"
                       th:class="${#fields.hasErrors('password')}? 'form-control
    fieldError' : 'form-control'">
                <p th:if="${#fields.hasErrors('password')}"
                   th:errors="*{password}">Incorrect date</p>
            </div>

            <div class="form-group">
                <label th:for="password2">비밀번호확인</label>
                <input type="hidden" th:name="${_csrf.parameterName}"
                       th:value="${_csrf.token}" />
                <input type="password" class="form-control" id="pw2"
                       placeholder="비밀번호를 입력하세요">
            </div>

            <div class="form_footer">
                <button type="submit" class="btn btn-primary" onclick="">Submit</button>
                    <a href="/member/login" style="float-right">이미 계정이 존재하신다면 클릭해주세요.</a>
                </div>


            </form>
            <br/>
            <div th:replace="fragments/footer :: footer" />
            </div> <!-- /container -->
    </body>
    </html>