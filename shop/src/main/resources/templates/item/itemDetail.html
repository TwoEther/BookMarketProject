<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="fragments/header :: header" />

<style>
    ul.tabs{
        margin: 0px;
        padding: 0px;
        list-style: none;
    }
    ul.tabs li{
        background: none;
        color: #222;
        display: inline-block;
        padding: 10px 15px;
        cursor: pointer;
    }

    ul.tabs li.current{
        color: #222;
    }

    .tab-content{
        display: none;
        padding: 15px;
    }

    .tab-content.current{
        display: inherit;
    }

    .review-btn > * {
        float:right;
    }

    button {
        border : none;
        background-color: rgba(0,0,0,0);
    }

    textarea {
        width: 100%;
        height: 100px;
        padding: 12px 14px;
        color: #000;
        border: 1px solid #d5d5d5;
        border-radius: 6px;
        font-size: 14px;
        line-height: 22px;
        letter-spacing: -0.01em;
        font-family: "Noto Sans KR", sans-serif;
        background-color: #fff;
        box-sizing: border-box;
        transition: background 0.2s ease-out, border-color 0.2s ease-out;
        outline: 0;
        overflow-y: auto;
        resize: none;


</style>
<body>

<script>
    function formatByKoreanMoney(){
        var money = $('.product-price').val();
        var new_money = money.toLocaleString();
        console.log(new_money);
        $('.product-price').val(new_money);
    }

    function clickedPlusButton(){
        var quantity = Number($('#quantity').val());
        $('#quantity').val(quantity+1);
    }

    function clickedMinusButton(){
        var quantity = Number($('#quantity').val());
        if(quantity > 0){ $('#quantity').val(quantity-1); }
    }

    function addToCart(){
        var quantity = Number($('#quantity').val());
        var token = $("meta[name='_csrf']").attr("content");
	    var header = $("meta[name='_csrf_header']").attr("content");
		var name = $("#userName").val();


       $.ajax({
            type: "POST",
            url: "/cart/add",
            beforeSend : function(xhr){
				xhr.setRequestHeader(header, token);
            },
            data : {"itemId": [[${item.id}]],
                    "quantity": quantity},
            success: function () {
                alert("장바구니에 담겼습니다");
                location.reload();
            },
            error:function(request, status, error){
        		alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error); }
        });
    }

    $(document).ready(function(){
        $('ul.tabs li').click(function(){
            var tab_id = $(this).attr('data-tab');

            $('ul.tabs li').removeClass('current');
            $('.tab-content').removeClass('current');

            $(this).addClass('current');
            $("#"+tab_id).addClass('current');
        })

    })

    function deleteReview(temp){
        var reviewId = temp.split('-')[1];
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");
           $.ajax({
                type: "DELETE",
                url: "/review/delete/"+reviewId,
                data : {"reviewId": reviewId},
                beforeSend: function (xhr) {
                      xhr.setRequestHeader(header, token);
                    },
                success: function (flag) {
                    if(!flag){alert("접근 권한이 없습니다");}
                    else{alert("삭제 되었습니다");}
                    location.reload();
                },
                error:function(request, status, error){
                    alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error); }
            });
        }

    function addLikeReview(id){
        var reviewId = id;
        var token = $("meta[name='_csrf']").attr("content");
        var header = $("meta[name='_csrf_header']").attr("content");

        $.ajax({
            type: "POST",
            url: "/review/like/"+reviewId,
            data : {"reviewId": reviewId},
            beforeSend: function (xhr) {
                  xhr.setRequestHeader(header, token);
                },
            success: function (data) {
                if(data == 0){
                    alert("로그인 후 이용가능 합니다");
                }else if(data == 1){
                    var element = document.getElementById("likeNum-"+reviewId);
                    element.innerText = Number(element.innerText)+1;
                    document.querySelector("#likeBtn-"+reviewId).className="fa-solid fa-thumbs-up";

                }else if(data == 2){
                    var element = document.getElementById("likeNum-"+reviewId);
                    element.innerText = Number(element.innerText)-1;
                    document.querySelector("#likeBtn-"+reviewId).className="fa-regular fa-thumbs-up";

                }else{}
            },
            error:function(request, status, error){
                alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error); }
        });
    }


    $('#openModalBtn').on('click', function(){
        $('#modalBox').modal('show');
    });

    // 모달 안의 취소 버튼에 이벤트를 건다.
    $('#closeModalBtn').on('click', function(){
        $('#modalBox').modal('hide');
    });


    $(document).ready(function(){
        $('ul.tabs li').click(function(){
            var tab_id = $(this).attr('data-tab');

            $('ul.tabs li').removeClass('current');
            $('.tab-content').removeClass('current');

            $(this).addClass('current');
            $("#"+tab_id).addClass('current');
        })

    })



</script>

<div>
    <header>
        <div th:replace="fragments/topHeader :: topHeader" />
        <div th:replace="fragments/mainHeader :: mainHeader" />
    </header>

    <!-- NAVIGATION -->
    <nav th:replace="fragments/navbar :: navbar" />
    <!-- /NAVIGATION -->


    <!-- SECTION -->
    <div class="section" onload="formatByKoreanMoney()">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">
                <!-- Product main img -->
                <div class="col-md-6 col-md-push-2">
                    <div id="product-main-img">
                        <div class="product-preview">
                            <img th:src="${item.getFilePath()}" alt="" style="width:250px;">
                        </div>

                    </div>
                </div>
                <!-- /Product main img -->


                <!-- Product details -->
                <div class="col-md-6">
                    <div class="product-details">
                        <h2 class="product-name" th:text="${item.name}"></h2>
                        <div>
                            <div class="product-rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star-o"></i>
                            </div>
                            <a class="review-link" href="#"><span th:text="${allReview.size()}+' Review(s) '"></span></a>
                        </div>
                        <div>
                            <h3 class="product-price" th:text="${#numbers.formatInteger(item.price, 3,'COMMA')}"><del class="product-old-price">$990.00</del></h3>
                            <span class="product-available">In Stock</span>
                        </div>
                        <p th:text="${item.description}"></p>

                        <div class="add-to-cart">
                            <div class="qty-label">
                                수량
                                <div class="input-number">
                                    <input id="quantity" type="number" value="0">
                                    <span class="qty-up" onclick="clickedPlusButton()">+</span>
                                    <span class="qty-down" onclick="clickedMinusButton()">-</span>
                                </div>
                            </div>
                            <button class="add-to-cart-btn" sec:authorize="isAuthenticated()" onclick="addToCart()"><i class="fa fa-shopping-cart"></i>장바구니 추가</button>
                        </div>

                        <ul class="product-btns">
                            <li><a href="javascript:void(0);" onclick="javascript:likeItemForm.submit();"><i class="fa fa-heart-o"></i> 찜하기</a></li>
                            <li><a href="#"><i class="fa fa-exchange"></i> add to compare</a></li>
                            <form th:action="@{/like/add}" method="post" name="likeItemForm" style="display:hidden;">
                                <input type="hidden" name="itemId" th:value="${item.id}">
                            </form>
                        </ul>

                        <ul class="product-links">
                            <li>Category:</li>
<!--                            <li><a href="#"><span th:text="{item.getCategory().category1}"></span></a></li>-->
<!--                            <li><a href="#"><span th:text="{item.getCategory().category2}"></span></a></li>-->
                        </ul>

                        <ul class="product-links">
                            <li>Share:</li>
                            <li><a href="#"><i class="fa fa-facebook"></i></a></li>
                            <li><a href="#"><i class="fa fa-twitter"></i></a></li>
                            <li><a href="#"><i class="fa fa-google-plus"></i></a></li>
                            <li><a href="#"><i class="fa fa-envelope"></i></a></li>
                        </ul>

                    </div>
                </div>
                <!-- /Product details -->

                <!-- Product tab -->
                <div class="col-md-12">
                    <div id="product-tab">
                        <!-- product tab nav -->
                        <ul class="tabs">
                            <li class="tab-link current" data-tab="tab-1">정보</li>
                            <li class="tab-link" data-tab="tab-2">리뷰</li>
                            <li class="tab-link" data-tab="tab-3">문의</li>
                        </ul>
                        <hr>
                        <!-- /product tab nav -->

                        <!-- product tab content -->
                        <div class="tab-content-three">
                            <!-- tab1  -->
                            <div id="tab-1" class="tab-content current">
                                <div class="row">
                                    <div class="col-md-12">
                                        <p th:text="${item.description}"></p>
                                    </div>
                                    <button type="button" class="btn btn-primary btn-lg" id="openModalBtn">	모달 보기 버튼</button>
                                    <!-- 모달 영역 -->
                                    <div id="modalBox" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
                                        <div class="modal-dialog" role="document">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">×</span></button>
                                                    <h4 class="modal-title" id="myModalLabel">모달 타이틀</h4>
                                                </div>
                                                <div class="modal-body">
                                                    내용
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-primary">확인</button>
                                                    <button type="button" class="btn btn-default" id="closeModalBtn">취소</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>


                                </div>
                            </div>
                            <!-- /tab1  -->

                            <!-- tab2  -->
                            <div id="tab-2" class="tab-content">
                                <div class="row">
                                    <!-- Rating -->
                                    <div class="col-md-3">
                                        <div id="rating">
                                            <div class="rating-avg">
                                                <span th:text="${avgScore}"></span>
                                                <div class="rating-stars">
                                                    <div th:if="${avgScore} >= 5" class="review-rating">
                                                        <i th:each="page: ${#numbers.sequence(1, avgScore, 1)}" class="fa fa-star"></i>
                                                    </div>
                                                    <div th:unless="${avgScore} >= 5" class="review-rating">
                                                        <i th:each="page: ${#numbers.sequence(1, avgScore, 1)}" class="fa fa-star"></i>
                                                        <i th:each="page: ${#numbers.sequence(avgScore + 1, 5, 1)}" class="fa fa-star-o empty"></i>
                                                    </div>
                                                </div>
                                            </div>
                                            <ul class="rating">
                                                <li>
                                                    <div class="rating-stars">
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                    </div>
                                                    <div class="rating-progress">
                                                        <div style="width: 80%;"></div>
                                                    </div>
                                                    <span class="sum" th:text="${reviewCount[5]}">3</span>
                                                </li>
                                                <li>
                                                    <div class="rating-stars">
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star-o"></i>
                                                    </div>
                                                    <div class="rating-progress">
                                                        <div style="width: 60%;"></div>
                                                    </div>
                                                    <span class="sum" th:text="${reviewCount[4]}">3</span>
                                                </li>
                                                <li>
                                                    <div class="rating-stars">
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star-o"></i>
                                                        <i class="fa fa-star-o"></i>
                                                    </div>
                                                    <div class="rating-progress">
                                                        <div></div>
                                                    </div>
                                                    <span class="sum" th:text="${reviewCount[3]}">3</span>
                                                </li>
                                                <li>
                                                    <div class="rating-stars">
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star-o"></i>
                                                        <i class="fa fa-star-o"></i>
                                                        <i class="fa fa-star-o"></i>
                                                    </div>
                                                    <div class="rating-progress">
                                                        <div></div>
                                                    </div>
                                                    <span class="sum" th:text="${reviewCount[2]}">3</span>
                                                </li>
                                                <li>
                                                    <div class="rating-stars">
                                                        <i class="fa fa-star"></i>
                                                        <i class="fa fa-star-o"></i>
                                                        <i class="fa fa-star-o"></i>
                                                        <i class="fa fa-star-o"></i>
                                                        <i class="fa fa-star-o"></i>
                                                    </div>
                                                    <div class="rating-progress">
                                                        <div></div>
                                                    </div>
                                                    <span class="sum" th:text="${reviewCount[1]}">3</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                    <!-- Review Form -->
                                    <div class="col-md-9">
                                        <div id="review-form">
                                            <form th:action="@{/review/add}" method="post" class="review-form">
                                                <div class="col-md-9">
                                                    <textarea class="review_box" name="review" placeholder="리뷰를 작성해주세요"></textarea>
                                                </div>
                                                <div class="col-md-3">
                                                    <div class="input-rating">
                                                    <span>별점: </span>
                                                    <div class="stars">
                                                        <input id="star5" name="rating" value="5" type="radio"><label for="star5"></label>
                                                        <input id="star4" name="rating" value="4" type="radio"><label for="star4"></label>
                                                        <input id="star3" name="rating" value="3" type="radio"><label for="star3"></label>
                                                        <input id="star2" name="rating" value="2" type="radio"><label for="star2"></label>
                                                        <input id="star1" name="rating" value="1" type="radio"><label for="star1"></label>
                                                    </div>
                                                </div>
                                                    <input type="hidden" th:value="${item.id}" name="itemId">
                                                    <button class="primary-btn" onclick="createReview()">작성하기</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <div class="row">
                                    <!-- Reviews -->
                                    <div class="col-md-3"></div>
                                    <div class="col-md-6">
                                        <div id="reviews">
                                            <ul class="reviews">
                                                <li th:each = "review : ${allReview}">
                                                    <div class="review-heading">
                                                        <h5 class="name" th:text="${review.member.name}"></h5>
                                                        <p class="date" th:text="${review.created_at}">27 DEC 2018, 8:0 PM</p>
                                                        <div th:if="${review.score} >= 5" class="review-rating">
                                                            <i th:each="page: ${#numbers.sequence(1, review.score, 1)}" class="fa fa-star"></i>
                                                        </div>
                                                        <div th:unless="${review.score} >= 5" class="review-rating">
                                                            <i th:each="page: ${#numbers.sequence(1, review.score, 1)}" class="fa fa-star"></i>
                                                            <i th:each="page: ${#numbers.sequence(review.score + 1, 5, 1)}" class="fa fa-star-o empty"></i>
                                                        </div>
                                                    </div>
                                                    <div class="review-body">
                                                        <div class="review-text">
                                                            <p th:text="${review.text}"></p>
                                                        </div>
                                                        <div class="review-btn">
                                                            <button type="button" th:id="${review.id}" onclick="addLikeReview(this.id)"><i th:id="'likeBtn-'+${review.id}" class="fa-regular fa-thumbs-up"></i></button>
                                                            <p th:id="'likeNum-'+${review.id}" th:text="${review.likeNum}"></p>
                                                            <button type="submit" th:id="'delete-'+${review.id}" onclick="deleteReview(this.id)">삭제</button>

                                                        </div>
                                                    </div>
                                                </li>

                                            </ul>
                                            <ul class="reviews-pagination">
                                                <li class="active">1</li>
                                                <li><a href="#">2</a></li>
                                                <li><a href="#">3</a></li>
                                                <li><a href="#">4</a></li>
                                                <li><a href="#"><i class="fa fa-angle-right"></i></a></li>
                                            </ul>
                                        </div>
                                    </div>
                                    <div class="col-md-3"></div>
                                    <!-- /Reviews -->
                                </div>
                            </div>
                            <!-- /tab2  -->

                            <!-- tab3  -->
                            <div id="tab-3" class="tab-content">
                                <div class="row">
                                    <!-- Rating -->
                                    <div class="col-md-3">
                                        <p>문의</p>
                                    </div>
                                    <!-- Review Form -->
                                    <div class="col-md-9">
                                        <div id="inquiry_form">
                                            <form th:action="@{/inquiry/add}" method="post" class="review-form">
                                                <div class="col-md-9">
                                                    <textarea class="inquiry_box" name="inquiry_text" placeholder="문의를 자유롭게 작성해주세요, 단 비방이나 욕설의 경우 경고없이 삭제 될 수 있습니다."></textarea>
                                                </div>
                                                <div class="col-md-3">
                                                    <button type="submit" class="primary-btn">작성하기</button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                                <hr>
                                <div class="row">
                                    <div th:each="inquiry : ${allInquiry}">
                                        <div class="col-3"></div>
                                        <div class="col-6">

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <!-- /tab3  -->

                        </div>
                        <!-- /product tab content  -->
                    </div>
                </div>
                <!-- /product tab -->
            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /SECTION -->

    <!-- Section -->
    <div class="section">
        <!-- container -->
        <div class="container">
            <!-- row -->
            <div class="row">

                <div class="col-md-12">
                    <div class="section-title text-center">
                        <h3 class="title">Related Products</h3>
                    </div>
                </div>

                <!-- product -->
                <div class="col-md-3 col-xs-6">
                    <div class="product">
                        <div class="product-img">
                            <img src="./img/product01.png" alt="">
                            <div class="product-label">
                                <span class="sale">-30%</span>
                            </div>
                        </div>
                        <div class="product-body">
                            <p class="product-category">Category</p>
                            <h3 class="product-name"><a href="#">product name goes here</a></h3>
                            <h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
                            <div class="product-rating">
                            </div>
                            <div class="product-btns">
                                <button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
                                <button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
                                <button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
                            </div>
                        </div>
                        <div class="add-to-cart">
                            <button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
                        </div>
                    </div>
                </div>
                <!-- /product -->

                <!-- product -->
                <div class="col-md-3 col-xs-6">
                    <div class="product">
                        <div class="product-img">
                            <img src="./img/product02.png" alt="">
                            <div class="product-label">
                                <span class="new">NEW</span>
                            </div>
                        </div>
                        <div class="product-body">
                            <p class="product-category">Category</p>
                            <h3 class="product-name"><a href="#">product name goes here</a></h3>
                            <h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
                            <div class="product-rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                            </div>
                            <div class="product-btns">
                                <button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
                                <button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
                                <button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
                            </div>
                        </div>
                        <div class="add-to-cart">
                            <button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
                        </div>
                    </div>
                </div>
                <!-- /product -->

                <div class="clearfix visible-sm visible-xs"></div>

                <!-- product -->
                <div class="col-md-3 col-xs-6">
                    <div class="product">
                        <div class="product-img">
                            <img src="./img/product03.png" alt="">
                        </div>
                        <div class="product-body">
                            <p class="product-category">Category</p>
                            <h3 class="product-name"><a href="#">product name goes here</a></h3>
                            <h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
                            <div class="product-rating">
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star"></i>
                                <i class="fa fa-star-o"></i>
                            </div>
                            <div class="product-btns">
                                <button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
                                <button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
                                <button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
                            </div>
                        </div>
                        <div class="add-to-cart">
                            <button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
                        </div>
                    </div>
                </div>
                <!-- /product -->

                <!-- product -->
                <div class="col-md-3 col-xs-6">
                    <div class="product">
                        <div class="product-img">
                            <img src="./img/product04.png" alt="">
                        </div>
                        <div class="product-body">
                            <p class="product-category">Category</p>
                            <h3 class="product-name"><a href="#">product name goes here</a></h3>
                            <h4 class="product-price">$980.00 <del class="product-old-price">$990.00</del></h4>
                            <div class="product-rating">
                            </div>
                            <div class="product-btns">
                                <button class="add-to-wishlist"><i class="fa fa-heart-o"></i><span class="tooltipp">add to wishlist</span></button>
                                <button class="add-to-compare"><i class="fa fa-exchange"></i><span class="tooltipp">add to compare</span></button>
                                <button class="quick-view"><i class="fa fa-eye"></i><span class="tooltipp">quick view</span></button>
                            </div>
                        </div>
                        <div class="add-to-cart">
                            <button class="add-to-cart-btn"><i class="fa fa-shopping-cart"></i> add to cart</button>
                        </div>
                    </div>
                </div>
                <!-- /product -->

            </div>
            <!-- /row -->
        </div>
        <!-- /container -->
    </div>
    <!-- /Section -->

    <div th:replace="fragments/footer :: footer"/>
</div> <!-- /container -->
</body>
</html>