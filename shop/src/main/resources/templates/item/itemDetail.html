<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head th:replace="fragments/header :: header" />
<link rel="stylesheet" href="/static/css/detail.css">
<body>
<div class="container">
    <div th:replace="fragments/bodyHeader :: bodyHeader"/>
    <div class="container" style="margin-top: 50px;">
        <div class="bookNameArea">
            <h1 style="text-align: center;" th:text="${item.name}"></h1>
            <h4 style="text-align: center;" th:text="${item.description}"></h4>
        </div><hr>
        <div class="mainArea">
            <div class="row">
                <div class="col-6">
                    <img th:src="@{${item.getFilePath()}}" alt="" width="90%" height="">
                </div>
                <div class="col-6" id="itemArea">
                    <div class="itemName">
                        <p>저자 : <span th:text="${item.author}"></span></p>
                    </div>

                    <div class="itemPublisher">
                        <p>출판사 : <span th:text="${item.publisher}"></span></p>
                    </div>

                    <div class="itemPage">
                        <p><span th:text="${item.pages}"></span>p</p>
                    </div>

                    <div class="itemStock">
                        <p>현재 남은 재고 : <span th:text="${item.stockQuantity}"></span></p>
                    </div>

                    <div>
                        <div class="" style="margin-bottom: 10px;">
                            <div class="row">
                                <div class="col-5">
                                    <span class="price">가격 : <span id="priceText" th:text="${item.price}">0</span>원</span>
                                </div>

                                <div class="col-7 ">
                                        <span class="countBox">
                                            <button id="leftbtn" onclick="leftBtnClicked()"><span>-</span>
                                            </button>
                                            <input type="number" value="1" id="quantityBlock"></input>
                                            <span id="itemPrice" style="display:none;" th:text="${item.price}"></span>
                                            <button id="rightbtn" onclick="rightBtnClicked()">
                                                <span>+</span>
                                            </button>
                                        </span>
                                </div>
                                <script th:inline="javascript">
                                    function leftBtnClicked(){
                                        var result = document.getElementById('quantityBlock').value;
                                        result--;
                                        if(result < 0) result = 0;
                                        document.getElementById('quantityBlock').value = result;
                                        setPriceInHTML();
                                    }

                                    function rightBtnClicked(){
                                        var result = document.getElementById('quantityBlock').value;
                                        result++;
                                        document.getElementById('quantityBlock').value = result;
                                        setPriceInHTML();
                                    }

                                    function setPriceInHTML(){
                                        var price = "[[${item.price}]]";
                                        var count = document.getElementById('quantityBlock').value;
                                        console.log(price, count)
                                        result = price * count;
                                        document.getElementById('priceText').innerHTML = result;
                                    }
                                    function idCheck(){
                                        $.ajax({
                                            url : "/item/cart",
                                            type : "POST",
                                            dataType : "JSON",
                                            data : {"userId" : $("#userId").val()},
                                            beforeSend: function (xhr) {
                                              xhr.setRequestHeader(header, token);
                                            },
                                            success : function(flag){
                                                if(flag == 0){
                                                    $('#result').text('아이디를 입력해주세요.');
                                                }else if(flag == 1){
                                                    $('#result').text('사용 불가능한 아이디입니다.');
                                                }else if(flag == 2){
                                                    $('#result').text('중복된 아이디 입니다.');
                                                }
                                                else{
                                                    $('#result').text('사용 가능한 아이디입니다.');
                                                }
                                            },
                                            error:function(request,status,error){
                                            alert("code = "+ request.status + " message = " + request.responseText + " error = " + error); // 실패 시 처리
                                           }
                                        });
                                    }
                                </script>
                            </div>

                        </div>

                        <a class="btn btn-lg btn-primary" style="margin-right: 10px;" th:href="@{/item/cart}" sec:authorize="isAuthenticated()">장바구니 담기</a>
                        <a class="btn btn-lg btn-primary" th:href="@{/member/login}">구매하기</a>
                    </div>



                </div>
            </div>

        </div>


    </div>
        <div th:replace="fragments/footer :: footer"/>
    </div> <!-- /container -->
</body>
</html>